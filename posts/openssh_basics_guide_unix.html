<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="../styles.css">
  <title>OpenSSH Guide for UNIX-like Systems - Perhaps</title>
 </head>
 <body>
  <special-header></special-header>
   <article>
    <h2>OpenSSH Basics Guide for UNIX-like Systems</h2>
     <p class="date">Posted 2024-06-30, last edited 2024-10-11</p>
     <h3>Overview</h3>
     <ul>
      <li>What is SSH?</li>
      <li>How Does SSH Work?</li>
      <li>What is OpenSSH?</li>
      <li>Ensuring OpenSSH is Installed and Running</li>
      <li>Basic Usage</li>
      <li>SSH Keys</li>
      <li>Transferring the Public Key to the Server</li>
      <li>Server Configuration</li>
      <li>Configuration File</li>
      <li>Moving Files Over SSH</li>
      <li>Troubleshooting</li>
      <li>Additional Resources</li>
      <li>Closing Notes</li>
     </ul>
     <p>This guide assumes you know the basics of using the command line! If you're unsure about how to use the command line, read my guide <a href="command_line_basics_guide_unix.html">here</a>.</p>
     <h3>What is SSH?</h3>
      <p>The <i>Secure Shell</i> protocol (SSH for short) is the solution to a security problem that was discovered in 1995, when Tatu Ylönen discovered that a password sniffer was on his university network. He then created the first version of the protocol, now known as <i>SSH-1</i>. SSH was made to replace Telnet and serves a similar function of communicating and controlling other machines; typically remote servers. This allows system administrators to alter and configure systems remotely, which eleminates the need to be physically connected to the machine, and thus SSH is essential for any aspiring system administrator and/or developer to know!</p>
     <h3>How Does SSH Work?</h3>
      <p>Data is broken down into several packets, and each packet contains a five elements:</p>
      <ul>
       <li><i>Packet Length</i> --- The size of the packet.</li>
       <li><i>Padding</i> --------- Random bytes that don't mean anything; to enforce the encryption.</li>
       <li><i>Payload</i> --------- The actual data being sent.</li>
       <li><i>Padding</i> --------- Again, just random bytes for the encryption.</li>
       <li><i>Authentication</i> -- Code to ensure that nothing has been altered. </li>
      </ul>
      <p>The padding and payload is encrypted for every packet that is sent, making it much more secure than Telnet, which was unencrypted. But how does the authentication work?</p>
      <p>Think of the packet(s) you're sending as a file with a padlock on it, your padlock, and only you have the key. Then you send this file to your friend, who puts his padlock on it, and then sends it back to you, and you remove your padlock and send it back. Now your friend can remove his padlock and read the file.</p>
     <h3>What is OpenSSH?</h3>
     <p>OpenSSH is the most popular SSH client and server daemon, and is used by professionals (and hobbyists like myself) every day. It was forked from Björn Grönvall's OSSH software, and was released in 1999 by the <a href="https://openbsd.org">OpenBSD</a> team. A more in-depth read on their history and the team members who participated can be found <a href="https://www.openssh.com/history.html">here</a>.</p>
     <p class="quote"><i>"[Open Secure Shell] is the premier connectivity tool for remote login with the SSH protocol. It encrypts all traffic to eliminate eavesdropping, connection hijacking, and other attacks. In addition, OpenSSH provides a large suite of secure tunneling capabilities, several authentication methods, and sophisticated configuration options."</i></p>
     <p class="quote-credit">Quote from <a href="https://openssh.com">OpenSSH.com</a></p>
     <h3>Ensuring OpenSSH is Installed and Running</h3>
      <p>Most of our interaction with SSH/OpenSSH will be through the command line, so the first thing we need to do, is use a terminal to ensure that OpenSSH is installed on our client, i.e. the machine we want to connect <i>from</i>. Boot up your preferred terminal emulator, and run the following command:</p>
      <pre class="command">$ ssh -V</pre>
      <p>If the command returns a line containing a version number, you have OpenSSH installed! If you get an error, look up how to install OpenSSH for your UNIX-like environment. As there are so many package managers and ways to install OpenSSH, I will not cover it here.</p>
      <p>Once we've verified that OpenSSH is installed on your client machine, we must then ensure the same for the server, i.e. the machine we want to connect <i>to</i>.</p>
      <p>Now it's time to make sure the SSH daemon (sshd) is running on the server. As I can't cover every init system, I encourage you to look up your UNIX-like environment to find out how to start/stop/check daemons. If you are on a Linux distro however and are unsure about what init system you're running, you're most likely running <a href="https://systemd.io">systemd</a>, and here's how to check if a daemon is running using systemd:</p>
       <pre class="command"># systemctl status sshd.service</pre>
      <p>And here's how to start it, if it isn't running:</p>
       <pre class="command"># systemctl enable --now sshd.service</pre>
      <p>If you're not logged in as root, you need to run these commands with sudo!</p>
     <h3>Basic Usage</h3>
      <p>When we connect to a remote machine for the very first time, this could be anything from a virtual machine, another computer in our home, or an actual server that we're running/renting, we're going to get a seemingly intimidating prompt that states the authenticity of the host cannot be established. It then prints the key fingerprint for this host, and asks if we're sure we want to connect -- that's all it is, it's a confirmation prompt that asks if we <i>really</i> want to connect to the machine, we're trying to connect to.</p>
      <p>Now that we know what to expect, try to use the following command to connect to a remote machine:</p>
      <pre class="command">$ ssh username@address</pre>
      <p><span>ssh</span> is how we use OpenSSH.</p>
      <p><span>username</span> is the name of the user you want to log in as. This is the user on the <b>server</b>, not on the client!</p>
      <p><span>address</span> is the destination of the connection, i.e. the IP address of the server.</p>
      <p>Since this is likely the first time you're connecting to this specific machine, the scary prompt is going to appear, but just type <span>yes</span> and press enter to proceed with the connection. The prompt will appear every time you connect to a remote machine that is not listed in the <i>known_hosts</i> file, in the <i>~/ssh</i> directory. Typing <i>yes</i> to this prompt, will add this remote machine to the <i>known_hosts</i> file.
      <p>Then a password prompt should appear, this is password of the <i>user</i> we're trying to connect <i>as</i> -- not the user we're currently logged in as!</p>
     <h3>SSH Keys</h3>
      <p>What are keys? Keys are encrypted files that contain a long string of characters, and they are a lot safer than passwords, as they can be much more complicated and harder to crack!</p>
      <p>When we generate a pair of keys, we get a private key and a public key. We need to keep the private key hidden and safe from everyone else, the public key is safe to be shared, and is exactly what the server will need to have in order for us to log in without a password.</p>
      <p>Here's how we generate a new pair of keys:</p>
       <pre class="command">$ ssh-keygen -t ed25519 -f ~/.ssh/[filename] -C "This is a comment"</pre>
      <p>Here's what each part does:</p>
      <p><span>ssh-keygen</span> is the program we're running to generate the key pair.</p>
      <p><span>-t ed25519</span> is the key type. ed25519 is the standard and is considered the best.</p>
      <p><span>-f ~/.ssh/[filename]</span> is the location and name of the key we are generating.</p>
      <p><span>-C "This is a comment"</span> is uite self-explanatory; it leaves a comment on the key which can help the ones who need to use the key.</p>
      </ul>
      <p>I recommend using one key per remote machine, so that if one key is compromised, the others are safe.</p>
      <p>After running the above command, we should see a two new keys, a private key: <b><i>private_key_name</i></b> and a public key: <b><i>public_key_name.pub</i></b> in the <i>~/.ssh</i> directory. Notice the <i>.pub</i> at the end of the public key!</p>
      <h3>Transferring the Public Key to the Server</h3>
       <p>In order for us to connect to a machine that has password authentication disabled, we must first copy a <i>public</i> key (<b>not a private key!</b>) to the server you're trying to connect to.
        <pre class="command">$ ssh-copy-id -i ~/.ssh/public_key.pub username@address</pre>
     <h3>Server Configuration</h3>
      <p>For maximum security, I recommend disabling password authentication, so that we're forced to use the key pair we just generated in the previous section. To do this, edit the file <b><i>/etc/ssh/ssh_config</i></b>, on the server.</p>
      <p>Find the following line and edit it from this:</p>
      <pre class="command">#   PasswordAuthentication yes</pre>
      <p>To this:</p>
       <pre class="command">   PasswordAuthentication no</pre>
      <p>Notice the missing number sign! Removing the number sign uncomments the line, so that OpenSSH reads that line and configures itself accordingly.</p> 
      <p>Save and close the file.</p>
     <h3>Configuration File</h3>
      <p>A config file can be created in the <b><i>~/.ssh</i></b> directory, with the name <b><i>config</i></b> to make it easier and faster to connect to remote machines, and is essential when you're working with more than one remote machine.</p>
      <p>Here's the basic structure of the config file:
       <pre class="command">Host alias_to_be_used
 Hostname ip_address
 IdentityFile file_path
 User username</pre>
      <p>An example config file:</p>
       <pre class="command">Host pi
 Hostname 192.232.5.63
 IdentityFile ~/.ssh/pi
 User piuser

Host nas
 Hostname 192.102.10.44
 IdentityFile ~/.ssh/nas
 User nasuser</pre>
      <p>Now when we want to connect to a known remote machine, all we do is use the following command:</p>
       <pre class="command">$ ssh alias_to_be_used</pre>
      <p>Example:</p>
       <pre class="command">$ ssh pi</pre>
     <h3>Moving Files Over SSH</h3>
      <p>To move files from the local machine to the remote machine, we're going to use the <i><b>scp</b></i> command:</p>
      <pre class="command">$ scp example_file username@address:/path</pre>
      <p>If you disabled password authentication, as I recommended, the above command won't work, because you need to specify a key to be used:</p>
      <pre class="command">$ scp -i ~/.ssh/private_key_name example_file username@address:/path</pre>
      <p>The <span>-i</span> flag tells the command to use the specified key for authentication.</p>
      <p>Of course, change <span>path</span> to your desired directory path.</p>
      <p>To move files from the remote machine to the local machine:</p>
       <pre class="command">$ scp username@address:/path/example_file .</pre>
     <h3>Troubleshooting</h3>
     <h4>\_ Too Open Permissions</h4>
      <p>You may get a message stating that your permissions are too open, and if that's the case, run the following command:</p>
       <pre class="command">$ chmod 600 ~/.ssh/private_key_name</pre>
      <p>Replace <i>private_key_name</i> with the name of your private key(s.)</p>
      <p>You must do this for <i>every</i> private key!</p>
     <h4>\_ OpenSSH Still Allowing Password Authentication</h4>
      <p>If you are still able to connect to your server via SSH with only a password (and not being forced to use your key), you need to edit another file in addition to <i><b>/etc/ssh/ssh_config</b></i>. This file is located here: <i><b>/etc/ssh/sshd_config</b></i>.</p>
      <p>Find the following line and edit it from this:</p>
       <pre class="command">#PasswordAuthentication yes</pre>
      <p>To this:</p>
       <pre class="command">PasswordAuthentication no</pre>
      <p>Make sure to remove the <span>#</span> to uncomment the line!</p>
     <h3>Additional Resources</h3>
       <ul>
        <li><a href="https://www.openssh.com/manual.html">OpenSSH Manual Pages</a></li>
       </ul>
    <h3>Closing Notes</h3>
     <p>Thank you for reading this blog post!</p>
     <p>Was this useful? <a href="../">Perhaps</a>.</p>
   </article>
  <special-footer></special-footer>
  <script src="../scripts.js"></script>
 </body>
</html>
